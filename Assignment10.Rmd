
title: "Assignment10"
author: "Ahmet Hatip"
date: "12/1/2018"
output: html_document
---

```{r}
library(lubridate)
library(readr)
library(bestglm)
library(stringr)
```

```{r}
spring=read_csv("spring_maple_monitoringAug17clean.csv")
fall=read_csv("fall_maple_monitoringAug17coded.csv")
fall<- data.frame(fall)
spring<- data.frame(spring)
print(dim(spring))
print(dim(fall))
```
```{r}
colnames(fall)
#Dropping code columns in
fall=fall[ , -which(names(fall) %in% c("Concrete.Code","Habitat.Code","Shade.Code","Leaf.Color.Code","Leaf.Drop.Code","Fruit.Code","Maple.Code"))]
#changing names for columns to match
colnames(spring)[which(names(spring) == "Tree.ID.Number")] <- "Tree.ID"
colnames(spring)[which(names(spring) == "Shading")] <- "Shade"
colnames(fall)[which(names(fall) == "Tree.Circumference_in")] <- "Circumference_in"
#deleting duplicated
print(dim(fall))
print(dim(spring))
fall=fall[!(duplicated(fall) | duplicated(fall, fromLast = TRUE)), ]
spring=spring[!(duplicated(spring) | duplicated(spring, fromLast = TRUE)), ]
print(dim(fall))
print(dim(spring))
```

```{r}
# going to combine Srping's Flowers and Fall's Fruit columns
colnames(fall)[which(names(fall) == "Fruit")] <- "Fruit-Flowers"
colnames(spring)[which(names(spring) == "Flowers")] <- "Fruit-Flowers"
fall$Seasons="Fall"
spring$Seasons="Spring"
# making fall and spring combinable
fall$Leaf.buds=""
fall$Leaves.unfolded=""
fall$Leaves.unfolded=""
spring$Damage=""
spring$Leaf.Color=""
spring$Leaves.Dropping=""
spring$Other.Comments=""
fall$Tree.health=""

sort(colnames(fall))

length(colnames(fall))
sort(colnames(spring))
length(colnames(spring))
```
```{r}
#combined them both
full1=rbind(fall, spring)

```

```{r}
#looked at map, Longitude should be between -100 to -40 and Latitude between 35 to 50
useM=subset(full1,(Longitude>-100)&(Longitude<-40)&(Latitude>35)&(Latitude<50))
#looking at hist for numeric values to see if there is any outliers
for(i in c("Circumference_in","Latitude","Longitude")){
  hist(useM[,i])
}

dim(useM)
```

```{r}
#Circumference_in should always be postive and can't be greater than 1500 becauase #https://en.wikipedia.org/wiki/List_of_superlative_trees#Stoutest
full=subset(useM,(Circumference_in>0)&(Circumference_in<1500))
dim(full)
```
```{r}
unique(full$Shade)
```

```{r}
for(i in unique(full$Shade)){
  full$Shade[full$Shade==i]=str_trim(sub("\\(.*","",i))
}
unique(full$Shade)
unique(full$Maple.Species)
```


```{r}
#adding coded values
#scaling Latitude, Longitude
full$LatitudeS=scale(full$Latitude)
full$LongitudeS=scale(full$Longitude)
full$MSF=factor(full$Maple.Species)
full$DateN=strptime(full$Date, "%m/%d/%y")
#getting year-min(year)
full$yearM=factor(as.numeric(year(full$DateN))-min(as.numeric(year(full$DateN))))
full$ConcreteF= ifelse(full$Concrete=="Yes", 1, 0)
full$SF= factor(full$Shade)
full$SeasonsF=factor(full$Seasons)
full$HabitatF=factor(full$Habitat)
#some Circumference_in are negative, will make them positive
full$Circumference_inP=abs(full$Circumference_in)
useMe1=full[,c("Circumference_inP","ConcreteF","yearM","HabitatF","LatitudeS","LongitudeS","MSF","SF","SeasonsF")]
```

```{r}
for(col in colnames(useMe1)){
  cat("\n",col,sum(is.na(useMe1[col])))
}
dim(useMe1)
useMe=na.omit(useMe1)
dim(useMe)
```


# Section 1: ANOVA Analysis
```{r}
#one: tree size and type
oneA=aov(Circumference_inP~MSF,data=useMe)
summary(oneA)
plot(oneA)
TukeyHSD(oneA)
```

conditions:
1- Zero mean:looks like it has zero mean
2- Constant variance: most of the points have a constant mean
3- Normality:looks normal but a bit postive skewed and some fat tails
4- Independence: one of my assumptions, cannot prove it 

the p-value is low, so it shows that the species of maples can explain the Circumference of the maple trees which makes sense

all of the trees means are significantly different and from the most to the least it is: Norway, red, silver, sugar

```{r}
#two: tree size in type vs shade
twoA=aov(Circumference_inP~MSF+SF,data=useMe)
summary(twoA)
plot(twoA)
TukeyHSD(twoA)
```

conditions:
1- Zero mean: the residuals do have a mean that is near zero but it tends to be more negative as the fitted values increase
2- Constant variance: there looks like some fanning out towards the middle of the fitted values but the ends look fine
3- Normality: both tails seen to be fat but it is a bit postive skewed
4- Independence: one of my assumptions, cannot prove it 

both p-values are low so it shows that both the amount of shade and Maple Species have different Circumferences in inches, 
all of the trees means are significantly different and from the most to the least it is: Norway, red, silver, sugar
from the shades, the means and from the most to the least it is: shaded, Partially Shaded, open

```{r}
#two with: tree size in type vs concrete interaction
twoW=aov(Circumference_inP~MSF+SF+MSF*SF,data=useMe)
summary(twoW)
plot(twoW)

```

conditions:
1- Zero mean: the residuals means look pretty close to zero
2- Constant variance: there is some fanning in the middle but it does not really matter
3- Normality: looks normal but slightly postivity skewed
4- Independence: one of my assumptions, cannot prove it 

```{r}
interAct=lm(Circumference_inP~MSF+SF+MSF*SF,data=useMe)
summary(interAct)
anova(interAct)
interAct$coefficients
```
all the individual features are significant but for some interaction coefficients like MSFSilver Maple:SFShaded and MSFSugar Maple:SFPartially Shaded it produces NA, probabily because there are no trees that is silver Maple and shaded and Sugar and Partially shaded

```{r}
unique(useMe$MSF)
unique(useMe$SF)
dim(useMe)[1]
dim(useMe[(useMe$MSF=="Sugar Maple")&(useMe$SF=="Partially Shaded"),])[1]
dim(useMe[(useMe$MSF=="Silver Maple")&(useMe$SF=="Shaded"),])[1]
```

```{r}
for(i in unique(useMe$MSF)){
  for(j in unique(useMe$SF)){
    cat("\n",i," ",j, dim(useMe[(useMe$MSF==i)&(useMe$SF==j),])[1])
  }
}
```
or because Norway and Partially Shaded has 0 trees thats y the value is 0


# Section 2: Logistic Regression
```{r}
# drop all nan values:
logData=na.omit(useMe)
dim(useMe)
dim(logData)

```


```{r}

#predict concrete
drops <- "ConcreteF"
# y is what we are trying to predict
y=logData$ConcreteF
# X is all the variables that will be used to predict
X=logData[ , !(names(logData) %in% drops)]

# idk but for this package u have to do this
Xy<-as.data.frame(cbind(X,y))
```



```{r}
# and do this for it to work
names(logData)<-c(paste("X",1:length(colnames(X)),sep=""),"y")
# and it works
bestAIC <- bestglm(Xy, IC="AIC",family = binomial)
#bestBIC <- bestglm(Xy, IC="BIC",family = binomial)
#bestEBIC <- bestglm(Xy, IC="BICg",family = binomial)
#bestBICq <- bestglm(Xy, IC="BICq",family = binomial)

```

```{r} 
bestAIC
```

```{r}
besLog=glm(ConcreteF~
Circumference_inP+
HabitatF+
MSF+
SF+
SeasonsF,
data=na.omit(useMe)
)
summary(besLog)

cat("\n","p-value",1-pchisq(besLog$null.deviance-besLog$deviance,besLog$df.null-besLog$df.residual))
besLog$null.deviance-besLog$deviance
```

some of the values are not signficiant so I will try to combine them with the value that is not included

```{r}
newLog=data.frame(useMe)
newLog$HabitatF=ifelse(newLog$HabitatF=="Other","Other","others")
newLog$SF=ifelse(newLog$SF=="Partially Shaded","Partially Shaded","others")
library(plyr)
newLog$MSF=revalue(newLog$MSF,c("Silver Maple"="Silver/Norway","Norway Maple"="Silver/Norway"))
for( i in c("HabitatF","SF","MSF")){
 print(unique(newLog[,i]))
 print(unique(useMe[,i]))
}

```
```{r}
besLog1=glm(ConcreteF~
Circumference_inP+
HabitatF+
MSF+
SF+
SeasonsF,
data=newLog
)
summary(besLog1)
cat("\n","p-value",1-pchisq(besLog1$null.deviance-besLog1$deviance,besLog1$df.null-besLog1$df.residual))
besLog1$null.deviance-besLog1$deviance
```

much better and the  Null deviance-Residual deviance is lower too 


This logistic regression tries to predict if a tree given its Circumference, Habitat, speices, shade amount and the season the tree was checked out, is near Concrete or not. It kinda makes sense because variables like Circumference, Habitat, speices and shade amount can be effected based on if it is near concrete or not. But seasons do not really cause or effect trees being close to concrete or not because all tree witness winter and summer almost equally

the p-value is zero, so that means that some of the coefficients are useful in explaining if a tree is near Concrete or not



# Section 3: Multiple Linear Regression
```{r}
#predict tree size all data
library(leaps)
bigMod = regsubsets(Circumference_inP~ConcreteF+yearM+HabitatF+LatitudeS+LongitudeS+MSF+SF+SeasonsF,data=useMe,nvmax = 26,nbest = 26,really.big=T)

ss=ShowSubsets(bigMod)

ssCP=ss[order(ss$Cp,decreasing = F),]

ssAR=ssCP[order(ssCP$adjRsq,decreasing = T),]
ssCP
ssAR

```
```{r}
(t(ssCP[1,]))
```
I think this one is the best one because it has the lowest Cp

```{r}
mod2Lm=lm(Circumference_inP~
ConcreteF+  
yearM+     
HabitatF+      
LatitudeS+
MSF+
SF+
SeasonsF,data=useMe)
summary(mod2Lm)

```
Year's p-values is too high, will drop

```{r}
mod2Lm=lm(Circumference_inP~
ConcreteF+  
HabitatF+      
LatitudeS+
MSF+
SF+
SeasonsF,data=useMe)
summary(mod2Lm)
```
```{r}
plot(mod2Lm)
```


Conditions for linear regression:
1. Zero means: the residuals does look like they are centered at zero
2. Constant Variance: the variance does looks like it is the same but towards the middle it grows
3. Independence: I deleted duplicated data points because of independence, but this will be our biggest assumption because i did not collect the data
4. Normality: looks normal but has a bit of fat tails and more postive skeweness

sense:
```{r}
mod2Lm$coefficients

```
It does not really make sense to do this analyst. Nothing here causes a tree to grow but, using the coefficients we can see which characteritics causes a large tree. 
Like when ConcreteF is 1, which means that the tree located  within 100 feet of buildings, concrete, or asphalt, they tend to be larger because the coefficient is postive. However, the less sun the tree gets the less larger it would be, which makes sense because larger trees would be above it. most of these values make sense but for season it is a bit werid because trees do not get randomly wider in the spring. Howvever it may be that more trees are accessible in the Spring than in the fall because of snow 


# Section 4: Further Analysis

```{r}
full1=na.omit(full1)
library(ggplot2)
library(ggthemes)
library(raster)
library(rgeos)
states=c( "Maine", "New York", "New Jersey", "Vermont", "Massachusetts", "Rhode Island", "Connecticut", "New Hampshire", "Pennsylvania")
prov=c("Ontario","Quebec","New Brunswick")
usa <- getData("GADM", country= "USA", level=1)
cand <- getData("GADM", country= "CAN", level=1)
#ny=bbox(usa[usa$NAME_1 %in% states,])
canp=fortify(cand[cand$NAME_1 %in% prov,])
ny=fortify(usa[usa$NAME_1 %in% states,])
full1$color="grey"
full1$color[(full1$Maple.Species=="Red Maple")]="red"
full1$color[(full1$Maple.Species=="Silver Maple")]="blue"
full1$color[(full1$Maple.Species=="Sugar Maple")]="yellow"
full1$color[(full1$Maple.Species=="Norway Maple")]="green"

```
```{r}
full3=subset(full1,
             (Longitude>-85)
              &(Latitude>10)
             )
full2=subset(full3,
             (Longitude< - 60)
#             &(Latitude<50)
)
plot(y=full2$Latitude,x=full2$Longitude)
useF=full2
table(useF$Maple.Species)
table(useF$color)
```






```{r}
gg <- ggplot(useF)
gg <- gg + geom_map(data=ny, map=ny, 
                    aes(x=long, y=lat, map_id=id, group=group),
                    fill=NA, color="black")
gg <- gg + geom_map(data=canp, map=canp, 
                    aes(x=long, y=lat, map_id=id, group=group),
                    fill=NA, color="black")
gg <- gg + geom_point(data=useF, aes(x=Longitude, y=Latitude,colour = color), 
                      alpha=1, na.rm=TRUE,size=.5)

gg <- gg + scale_size(range=c(2,7))
gg <- gg + scale_color_identity()
gg <- gg + labs(title= "coordinate data of tree species", 
                x="Longitude", y= "Latitude")
gg <- gg + coord_map()
gg <- gg + theme_map()
gg <- gg + theme(title= element_text(hjust = 0.5, vjust=1, face="bold"))
gg
```
I used the ggplot2 package to plot the trees on the map of usa and canada and show which types of trees are located where. It looks like the trees are spread out a bit and mostly in New York which makes sense because the organization is based there





